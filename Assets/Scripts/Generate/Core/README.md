# Core Generator Framework

Модульная система для создания генераторов контента в Unity с поддержкой процессов и слоев генерации.

## Компоненты системы

### Генераторы
- `BaseGenerator` - базовый класс для всех генераторов
- `GeneratorCore` - ядро системы генерации
- `GeneratorData` - контейнер данных для генерации
- Поддержка асинхронного выполнения
- Система валидации данных

### Процессы
- `BaseProcessGenerator` - базовый класс процессов
- `IGeneratorProcess` - интерфейс для процессов генерации
- Возможность включения/выключения процессов
- Возможность регенерации отдельных процессов
- Атрибут `GeneratorProcess` для привязки к генератору

### Слои
- `ProcessLayer` - базовый класс для слоев
- `LayersContainer` - контейнер управления слоями
- `LayersExecutor` - исполнитель логики слоев
- Атрибут `OptionalLayers` для настройки в инспекторе

### Система контекстов
- Передача данных между процессами и слоями
- Типизированный доступ к контексту через TryGetContext
- Валидация данных контекста
- Поддержка множественных контекстов в рамках одного процесса

### Редактор
- Визуальный интерфейс для настройки генераторов
- Поддержка drag&drop для процессов
- Отображение прогресса генерации
- Система стилей и иконок
- Валидация в редакторе

## Быстрый старт

### 1. Создание генератора

[CreateAssetMenu(menuName = "Generate/MyGenerator")]
public class MyGenerator : BaseGenerator 
{
  protected override async UniTask OnInitialize()
  {
    // Инициализация генератора
    await UniTask.Yield();
  }

  protected override async UniTask OnGenerate()
  {
    // Дополнительная логика генерации
    await UniTask.Yield();
  }
}

### 2. Создание процесса

[GeneratorProcess(typeof(MyGenerator))]
public class MyProcess : BaseProcessGenerator
{
  [SerializeField] private int width;
  [SerializeField] private int height;
    
  public override bool ValidateRegeneration(out string error)
  {
    if(width <= 0)
    {
      error = $"{DisplayName}: Width must be greater than 0";
      return false;
    }
    
    if(height <= 0)
    {
      error = $"{DisplayName}: Height must be greater than 0";
      return false;
    }
    
    return base.ValidateRegeneration(out error);
  }
}

### 3. Создание слоя

[CreateAssetMenu(menuName = "Generate/Layers/MyLayer")]
public class MyLayer : ProcessLayer
{
  private MyContextData contextData;

  protected override async UniTask OnInit()
  {
    await UniTask.CompletedTask;
  }

  protected override async UniTask OnGenerate()
  {
    // Логика генерации
    await UniTask.CompletedTask;
  }
}

## Настройка в редакторе

1. Создание генератора:
   - Добавьте компонент генератора на GameObject
   - Настройте базовые параметры в инспекторе
   - Укажите GeneratorData с необходимыми данными

2. Добавление процессов:
   - Выберите тип процесса из выпадающего списка
   - Нажмите кнопку Add
   - Настройте параметры процесса
   - Порядок процессов важен - они выполняются сверху вниз

3. Настройка слоев:
   - Создайте новый LayersContainer через меню Assets
   - Добавьте слои в контейнер
   - Настройте параметры каждого слоя
   - Назначьте контейнер процессу через поле Layers

## Лучшие практики

1. Порядок процессов:
   - Располагайте процессы в порядке их зависимостей
   - Используйте drag&drop для изменения порядка
   - Процессы выполняются последовательно сверху вниз

2. Работа со слоями:
   - Группируйте связанные слои в отдельные контейнеры
   - Включайте только необходимые слои для оптимизации
   - Используйте контексты для передачи данных между слоями

3. Валидация:
   - Всегда реализуйте ValidateGenerator() и ValidateRegeneration()
   - Предоставляйте понятные сообщения об ошибках
   - Проверяйте входные данные перед генерацией

4. Обработка ошибок:
   - Используйте try-catch в критических секциях
   - Логируйте ошибки через Debug.LogError
   - Возвращайте понятные сообщения об ошибках

5. Контексты:
   - Создавайте отдельные классы для контекстов
   - Используйте интерфейсы для типизации
   - Проверяйте наличие контекста через TryGetContext

## Структура проекта

- Core/
  - Attributes/ - Атрибуты для настройки компонентов
  - Data/ - Классы для хранения данных
  - Editor/ - Компоненты редактора Unity
  - Generator/ - Базовые классы генераторов
  - Layers/ - Система слоев
  - Utils/ - Вспомогательные классы

## Примечания

- Система поддерживает асинхронное выполнение через UniTask
- Возможна отмена генерации через CancellationToken
- Процессы могут быть независимо включены/выключены
- Поддерживается частичная регенерация через отдельные процессы
- Все процессы и слои поддерживают горячую перезагрузку
- Система валидации предотвращает некорректные состояния
- Редактор предоставляет визуальную обратную связь
